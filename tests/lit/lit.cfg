import lit.formats, os, os.path, sys
srcDir = os.path.dirname(__file__)
config.test_format = lit.formats.ShTest(True)
config.pipefail = False

# TODO: These need to be adjusted to the action runner / build.sh file
# compiler = lit_config.params["COMPILER"]
# lib = lit_config.params["STDLIBPATH"]
# arch = lit_config.params["ARCH"]
# config.substitutions.append(('%COMPILE', f'{compiler} -o /tmp/%basename_t.out -liec61131std -L{lib}{arch}/lib/ -i "{lib}/include/*.st" -i {srcDir}/helpers/printf.pli  --linker=cc'))
# config.substitutions.append(('%RUN', f'LD_LIBRARY_PATH="{lib}{arch}/lib" /tmp/%basename_t.out'))
# config.substitutions.append(('%CHECK', f'FileCheck-14 --check-prefixes GREY,CHECK --allow-unused-prefixes --match-full-lines'))

# ~/.local/bin/lit -v -DCOMPILER=/home/vosa@bachmann.at/Development/rusty/target/debug/plc ./tests/lit
compiler = lit_config.params["COMPILER"]
config.substitutions.append(('%COMPILE', f'{compiler} -o /tmp/%basename_t.out --linker=cc'))
config.substitutions.append(('%RUN', f'/tmp/%basename_t.out'))
config.substitutions.append(('%CHECK', f'FileCheck-14 --check-prefixes CHECK --allow-unused-prefixes --match-full-lines'))