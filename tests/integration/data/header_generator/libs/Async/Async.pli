(*****************************************************************************
 * Copyright (c) 2025 Bachmann electronic GmbH                               *
 *****************************************************************************)
(**
 * @defgroup async-interface Asynchronous interface
 * @brief Asynchronous task and job management functions.
 *
 * These functions provide an interface for creating and managing asynchronous tasks and jobs,
 * allowing for non-blocking execution of operations.
 * @{
*)
(**
 * @brief Get the current state of an asynchronous job
 *
 * Retrieves the current execution state of the specified asynchronous job.
 *
 * @param[in] JobHandle Handle to the asynchronous job.
 * @param[out] Error Error code.
 * @return Current state of the job.
 *)
FUNCTION ASYNC_JobGetState : ASYNC_JobState
VAR_INPUT
    JobHandle   :   ASYNC_JobHandle;
END_VAR
VAR_OUTPUT
    Error   : ErrorCode;
END_VAR
END_FUNCTION
(**
 * @brief Check if an asynchronous job can be canceled
 *
 * Determines whether the specified asynchronous job supports cancellation.
 *
 * @param[in] JobHandle Handle to the asynchronous job.
 * @param[out] Error Error code.
 * @return TRUE if the job can be canceled, FALSE otherwise.
 *)
FUNCTION ASYNC_JobIsCancelable : BOOL
VAR_INPUT
    JobHandle   :   ASYNC_JobHandle;
END_VAR
VAR_OUTPUT
    Error   : ErrorCode;
END_VAR
END_FUNCTION
(**
 * @brief Create a new asynchronous task
 *
 * Creates a new asynchronous task with the specified parameters. The task can be used
 * to execute multiple jobs asynchronously.
 *
 * @param[in] TaskParameters Configuration parameters for the new task.
 * @param[out] Error Error code.
 * @return Handle to the created task.
 * @see ASYNC_TaskDestroy
 *
 * <b>Code snippet</b>
 * @snippet Snippets.st async_task_create
 *)
FUNCTION ASYNC_TaskCreate : ASYNC_TaskHandle
VAR_INPUT
    TaskParameters        : ASYNC_TaskParams;
END_VAR
VAR_OUTPUT
    Error: ErrorCode;
END_VAR
END_FUNCTION
(**
 * @brief Destroy an asynchronous task
 *
 * Destroys the specified asynchronous task and releases all associated resources.
 * All pending jobs in the task will be canceled.
 *
 * @param[in] TaskHandle Handle to the task to destroy.
 * @return Error code.
 *)
FUNCTION ASYNC_TaskDestroy : ErrorCode
VAR_INPUT
    TaskHandle        : ASYNC_TaskHandle;
END_VAR
END_FUNCTION
(**
 * @brief Add a job to an asynchronous task
 *
 * Adds a new job to the specified asynchronous task. The job will be executed
 * asynchronously by the task. If @p Timeout is omitted, the job will run without timeout.
 *
 * The @p JobFunction must return a BOOL and take a pointer to the parameter (@p Params).
 * The return value of the @p JobFunction indicates whether an error occured.
 *
 * @param[in] TaskHandle Handle to the task.
 * @param[in] JobFunction Pointer to the function to execute.
 * @param[in] Params Pointer to parameters passed to the job function.
 * @param[in] State Reference to job state variable for monitoring execution.
 * @param[in] Timeout Maximum execution time in milliseconds (0 = no timeout).
 * @param[out] Error Error code.
 * @return Handle to the created job.
 *
 * <b>Code snippet</b>
 * @snippet Snippets.st async_task_add
 *)
FUNCTION ASYNC_TaskAddJob : ASYNC_JobHandle
VAR_INPUT
    TaskHandle: ASYNC_TaskHandle;
    JobFunction: POINTER TO BYTE;
    Params: POINTER TO BYTE;
    State: REF_TO ASYNC_JobState;
    Timeout: UDINT := 0;
END_VAR
VAR_OUTPUT
    Error: ErrorCode;
END_VAR
END_FUNCTION
(**
 * @brief Add a cancelable job to an asynchronous task
 *
 * Adds a new cancelable job to the specified asynchronous task. Unlike regular jobs,
 * cancelable jobs can be terminated before completion using ASYNC_JobCancel.
 * If @p Timeout is omitted, the job will run without timeout.
 *
 * The @p JobFunction must return a BOOL and take a pointer to the parameter (@p Params) as well as a REF_TO BOOL argument which tells whether to cancel the function.
 * The return value of the @p JobFunction indicates whether an error occured.
 *
 * @param[in] TaskHandle Handle to the task.
 * @param[in] JobFunction Pointer to the function to execute.
 * @param[in] Params Pointer to parameters passed to the job function.
 * @param[in] State Reference to job state variable for monitoring execution.
 * @param[in] Timeout Maximum execution time in milliseconds (0 = no timeout).
 * @param[out] Error Error code.
 * @return Handle to the created cancelable job.
 * @see ASYNC_JobCancel
 *
 * <b>Code snippet</b>
 * @snippet Snippets.st async_task_add_cancelable
 *)
FUNCTION ASYNC_TaskAddJobCancelable : ASYNC_JobHandle
VAR_INPUT
    TaskHandle: ASYNC_TaskHandle;
    JobFunction: POINTER TO BYTE;
    Params: POINTER TO BYTE;
    State: REF_TO ASYNC_JobState;
    Timeout: UDINT := 0;
END_VAR
VAR_OUTPUT
    Error: ErrorCode;
END_VAR
END_FUNCTION
(**
 * @brief Cancel an asynchronous job
 *
 * Cancels the execution of the specified asynchronous job. Only jobs created with
 * ASYNC_TaskAddJobCancelable can be canceled.
 *
 * @param[in] JobHandle Handle to the job to cancel.
 * @return Error code.
 * @see ASYNC_TaskAddJobCancelable
 *)
FUNCTION ASYNC_JobCancel: ErrorCode
VAR_INPUT
    JobHandle: ASYNC_JobHandle;
END_VAR
END_FUNCTION
(**
 * @brief Get the default asynchronous task
 *
 * Returns a handle to the default asynchronous task. This task is automatically
 * created and can be used without explicit task creation.
 *
 * @return Handle to the default task.
 *)
FUNCTION ASYNC_GetDefaultTask : ASYNC_TaskHandle
END_FUNCTION
(**
 * @brief Get the name of an asynchronous task
 *
 * Retrieves the name of the specified asynchronous task.
 *
 * @param[in] TaskHandle Handle to the task.
 * @return Name of the task (maximum 15 characters).
 *)
FUNCTION ASYNC_TaskGetName: STRING[15]
VAR_INPUT
    TaskHandle: ASYNC_TaskHandle;
END_VAR
END_FUNCTION
(**
 * @brief Get the priority of an asynchronous task
 *
 * Retrieves the execution priority of the specified asynchronous task.
 *
 * @param[in] TaskHandle Handle to the task.
 * @return Priority level of the task.
 *)
FUNCTION ASYNC_TaskGetPriority: UDINT
VAR_INPUT
    TaskHandle: ASYNC_TaskHandle;
END_VAR
END_FUNCTION
(**
 * @brief Asynchronous task function block
 *
 * Function block for managing asynchronous tasks. Provides an object-oriented
 * interface for working with asynchronous operations.
 *)
FUNCTION_BLOCK ASYNC_Task
VAR
    _Internal_ : POINTER TO BYTE;
END_VAR
(**
 * @brief Timeout property for the asynchronous task
 *
 * Gets or sets the default timeout value for jobs added to this task.
 *)
PROPERTY Timeout: UDINT
GET
END_GET
SET
END_SET
END_PROPERTY
(**
 * @brief Set the underlying asynchronous task handle
 *
 * Associates this function block instance with an existing asynchronous task handle.
 *
 * @param[in] TaskHandle Handle to the asynchronous task.
 *)
METHOD PUBLIC SetAsyncTask
VAR_INPUT
    TaskHandle: ASYNC_TaskHandle;
END_VAR
END_METHOD
(**
 * @brief Initialize the function block
 *
 * Initialization method called when the function block instance is created.
 *)
METHOD FB_INIT
END_METHOD
END_FUNCTION_BLOCK
(**
 * @}
*)
