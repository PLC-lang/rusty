(*****************************************************************************
 * Copyright (c) 2025 Bachmann electronic GmbH                               *
 *****************************************************************************)
(**
 * @defgroup file-async Asynchronous file interface
 * @brief Function block which provides asynchronous methods to the file facilities.
 *
 * The function block is based on the ASYNC_Task function block provided by the async library.
 * @{
*)
(**
 * @brief Asynchronous file operations function block
 *
 * This function block provides asynchronous file operations that extend the ASYNC_Task base class.
 * All methods are non-blocking and use the async task framework to manage operation state.
 * Each method takes parameters through a pointer to a parameter structure and returns the job state
 * through a pointer to ASYNC_JobState.
 *
 * The function block supports all standard file operations:
 * - File opening and closing
 * - Reading and writing binary data
 * - Reading and writing strings
 * - File positioning (seek/tell)
 * - File management (copy, rename, remove)
 * - File status information
 * - Buffer flushing
 *
 * @note All methods return an ErrorCode and update the job state asynchronously.
 * @see ASYNC_Task for base functionality
 *)
FUNCTION_BLOCK FILE_Async EXTENDS ASYNC_Task
VAR
    _Internal_ : POINTER TO BYTE;
END_VAR
(**
 * @brief Open or create a file asynchronously
 *
 * Opens or creates a file asynchronously. The behavior is defined by the Mode parameter in OpenParams.
 * If the Mode parameter is omitted, the file is opened read only.
 *
 * @param[in] OpenParams Pointer to FILE_OpenParams structure containing:
 *   - File: Specifies the file name (absolute or relative path)
 *   - Mode: Requested access mode
 *   - Error: Error code (output)
 *   - FileHandle: File handle (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_OpenParams, ASYNC_JobState
 *)
METHOD PUBLIC Open: ErrorCode
VAR_INPUT
    OpenParams: REF_TO FILE_OpenParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Close a file asynchronously
 *
 * Closes a file asynchronously and releases associated resources.
 *
 * @param[in] CloseParams Pointer to FILE_CloseParams structure containing:
 *   - FileHandle: File handle to close
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_CloseParams, ASYNC_JobState
 *)
METHOD PUBLIC Close: ErrorCode
VAR_INPUT
    CloseParams: REF_TO FILE_CloseParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Read data from a file asynchronously
 *
 * Reads up to Size bytes from a file into the buffer asynchronously. The actual number of bytes
 * read is returned in SizeRead. The function may return fewer bytes than requested if the end
 * of the file is reached.
 *
 * @param[in] ReadParams Pointer to FILE_ReadParams structure containing:
 *   - FileHandle: File handle to read from
 *   - Buffer: Pointer to the buffer where the read data will be stored
 *   - Size: Maximum number of bytes to read
 *   - SizeRead: Number of bytes actually read (output)
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_ReadParams, ASYNC_JobState
 *)
METHOD PUBLIC Read: ErrorCode
VAR_INPUT
    ReadParams: REF_TO FILE_ReadParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Write data to a file asynchronously
 *
 * Writes the specified number of bytes from the provided buffer to the given file asynchronously.
 * The actual number of bytes written is returned in SizeWritten.
 *
 * @param[in] WriteParams Pointer to FILE_WriteParams structure containing:
 *   - FileHandle: File handle to write to
 *   - Buffer: Pointer to the data buffer to be written
 *   - Size: Number of bytes to write from the buffer
 *   - SizeWritten: Number of bytes successfully written (output)
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_WriteParams, ASYNC_JobState
 *)
METHOD PUBLIC Write: ErrorCode
VAR_INPUT
    WriteParams: REF_TO FILE_WriteParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Read a line from a file into a string asynchronously
 *
 * Reads a line from a newline delimited file asynchronously. The line length is limited to 1024 bytes.
 * Reading stops at a newline character or when the end of the file is reached.
 *
 * @param[in] ReadStringParams Pointer to FILE_ReadStringParams structure containing:
 *   - FileHandle: File handle to read from
 *   - Output: The string containing the read line (output)
 *   - IsEOF: Indicates whether the end of the file has been reached (output)
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_ReadStringParams, ASYNC_JobState
 *)
METHOD PUBLIC ReadString: ErrorCode
VAR_INPUT
    ReadStringParams: REF_TO FILE_ReadStringParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Write a string to a file asynchronously
 *
 * Writes a string to a file asynchronously. The string is written as-is without automatic
 * newline termination.
 *
 * @param[in] WriteStringParams Pointer to FILE_WriteStringParams structure containing:
 *   - FileHandle: File handle to write to
 *   - Str: The string to be written
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_WriteStringParams, ASYNC_JobState
 *)
METHOD PUBLIC WriteString: ErrorCode
VAR_INPUT
    WriteStringParams: REF_TO FILE_WriteStringParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Set the file position indicator asynchronously
 *
 * Moves the file position indicator to the specified offset relative to the origin defined by
 * the Origin parameter asynchronously. The origin can be the beginning of the file, the current
 * position, or the end of the file. If Origin and Offset are omitted, the position is set to
 * the beginning of the file.
 *
 * @param[in] SeekParams Pointer to FILE_SeekParams structure containing:
 *   - FileHandle: File handle
 *   - Offset: Number of bytes to offset from the origin
 *   - Origin: Position used as reference for the offset
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_SeekParams, FILE_SeekOrigin, ASYNC_JobState
 *)
METHOD PUBLIC Seek: ErrorCode
VAR_INPUT
    SeekParams: REF_TO FILE_SeekParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Get the file position indicator asynchronously
 *
 * Returns the file position indicator for the file asynchronously. The position indicates
 * the number of bytes from the beginning of the file.
 *
 * @param[in] TellParams Pointer to FILE_TellParams structure containing:
 *   - FileHandle: File handle
 *   - Position: Number of bytes from the beginning of the file (output)
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_TellParams, ASYNC_JobState
 *)
METHOD PUBLIC Tell: ErrorCode
VAR_INPUT
    TellParams: REF_TO FILE_TellParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Flush file buffers asynchronously
 *
 * Writes any unwritten data from the stream's buffer to the associated output device asynchronously.
 * This ensures that all pending write operations are committed to storage.
 *
 * @param[in] FlushParams Pointer to FILE_FlushParams structure containing:
 *   - FileHandle: File handle to flush
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_FlushParams, ASYNC_JobState
 *)
METHOD PUBLIC Flush: ErrorCode
VAR_INPUT
    FlushParams: REF_TO FILE_FlushParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Copy a file asynchronously
 *
 * Copies the file specified by Source to the file specified by Destination asynchronously.
 * The number of bytes copied is returned in BytesCopied.
 *
 * @param[in] CopyParams Pointer to FILE_CopyParams structure containing:
 *   - Source: Path to the source file
 *   - Destination: Path to the destination file
 *   - BytesCopied: Number of bytes copied (output)
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_CopyParams, ASYNC_JobState
 *)
METHOD PUBLIC Copy: ErrorCode
VAR_INPUT
    CopyParams: REF_TO FILE_CopyParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Rename a file asynchronously
 *
 * Renames the file specified by OldName to NewName asynchronously. This operation can also
 * be used to move files between directories if the paths differ.
 *
 * @param[in] RenameParams Pointer to FILE_RenameParams structure containing:
 *   - OldName: Current file name/path
 *   - NewName: New file name/path
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_RenameParams, ASYNC_JobState
 *)
METHOD PUBLIC Rename: ErrorCode
VAR_INPUT
    RenameParams: REF_TO FILE_RenameParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Remove a file asynchronously
 *
 * Deletes the file specified by FileName asynchronously. Once deleted, the file cannot be recovered.
 *
 * @param[in] RemoveParams Pointer to FILE_RemoveParams structure containing:
 *   - FileName: Name/path of the file to remove
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_RemoveParams, ASYNC_JobState
 *)
METHOD PUBLIC Remove: ErrorCode
VAR_INPUT
    RemoveParams: REF_TO FILE_RemoveParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
(**
 * @brief Get file status information asynchronously
 *
 * Retrieves comprehensive status information about a file asynchronously, including file type,
 * permissions, ownership, size, and timestamps.
 *
 * @param[in] GetStatusParams Pointer to FILE_GetStatusParams structure containing:
 *   - FileHandle: File handle to query
 *   - Status: File status information structure (output)
 *   - Error: Error code (output)
 * @param[in,out] State Pointer to ASYNC_JobState for tracking operation progress
 * @return ErrorCode indicating immediate operation status
 * @see FILE_GetStatusParams, FILE_Status, ASYNC_JobState
 *)
METHOD PUBLIC GetStatus: ErrorCode
VAR_INPUT
    GetStatusParams: REF_TO FILE_GetStatusParams;
    State: REF_TO ASYNC_JobState;
END_VAR
END_METHOD
METHOD FB_INIT
END_METHOD
END_FUNCTION_BLOCK
(** @} **)
