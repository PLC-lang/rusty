(*****************************************************************************
 * Copyright (c) 2025 Bachmann electronic GmbH                               *
 *****************************************************************************)
(**
 * @addtogroup Log
 * @brief Logging facilities.
 *
 * The library provides a set of functions and macros to write log messages into systemd journal files.
 * The provided functions internally use functions of the systemd library (i.e.
 * <a href="https://www.freedesktop.org/software/systemd/man/sd_journal_print.html">sd_journal_printv</a>).
 *
 * <b>Severity level:</b><br>
 * All severity levels from @c journald and @c syslog are supported. Use the enumerator #LogLevel to provide the log
 * level or priority to the library functions.
 *
 * It is possible to define maximum log levels. If a log function is called, the log message is written to the journal
 * file only if the log level forwarded to the function call is less or equal to the maximum log level.
 *
 * Example:<br>
 * If the maximum log level is set to #LOG_LEVEL_ERROR, log messages with the log levels #LOG_LEVEL_EMERGENCY,
 * #LOG_LEVEL_ALERT, #LOG_LEVEL_CRITICAL and #LOG_LEVEL_ERROR are written to the journal file. Log messages with
 * other log levels are dismissed without any notification. The global maximum log level can be defined by using
 * Log_SetRootLevel(). This log level works for all threads, which have not defined an own log level. To set the
 * maximum log level for the current thread use Log_SetLevel().
 *
 * @{
 *)
(**
 * @brief Definition of log levels.
 *
 * The log levels are compatible with syslog/systemd-journal.
 *
 * Reference:
 *  - syslog.h
 *  - sd-journal.h
 *)
TYPE LogLevel :
(
    LOG_LEVEL_EMERGENCY := 0,    (**< Emergency, system is unusable *)
    LOG_LEVEL_ALERT := 1,        (**< Alert, action must be taken immediately *)
    LOG_LEVEL_CRITICAL := 2,     (**< Critical conditions *)
    LOG_LEVEL_ERROR := 3,        (**< Error conditions *)
    LOG_LEVEL_WARNING := 4,      (**< Warning conditions *)
    LOG_LEVEL_NOTICE := 5,       (**< Normal but significant condition *)
    LOG_LEVEL_INFO := 6,         (**< Informational *)
    LOG_LEVEL_DEBUG := 7,        (**< Debug-level messages *)
    LOG_LEVEL_INHERIT := -1 (**< Inherit log level from global scope (root level). @see Log_SetLevel() *)
);
END_TYPE
(**
 * @brief Print log message to the system journal.
 *
 * This routine submits the given log message in printf-format to the
 * systemd-journald. The first argument is a priority value. This is followed by
 * a format string and its parameters.
 *
 * @param[in] Priority the log priority
 * @param[in] Format the format string
 * @param[in] Args format parameters
 * @return Error code structure
 *)
FUNCTION Log_Print : ErrorCode
VAR_INPUT
    Priority : LogLevel;
    Format : STRING[1023];
    Args : ...;
END_VAR
END_FUNCTION
(**
 * @brief Send structured log message to the system journal.
 *
 * This routine may be used to submit structured log entries to the system journal.
 * The strings passed should be of the format "VARIABLE=value". It takes a series of format
 * strings, each immediately followed by their associated parameters, terminated by NULL(=0).
 * The variable name must be in uppercase and consist only of characters, numbers and underscores, and may not begin
 * with an underscore. (All assignments that do not follow this syntax will be ignored.) The value can be of any size
 * and format. It is highly recommended to submit text strings formatted in the UTF-8 character encoding only,
 * and submit binary fields only when formatting in UTF-8 strings is not sensible. A number of well-known fields are
 * defined, see
 * <a href="https://www.freedesktop.org/software/systemd/man/systemd.journal-fields.html#">systemd.journal-fields(7)</a>
 * for details, but additional application defined fields may be used.
 * A variable may be assigned more than one value per entry. If this function is used, trailing whitespace is
 * automatically removed from each formatted field.
 *
 * @param[in] Priority the log priority
 * @param[in] Format the format string
 * @param[in] Args format parameters
 * @return Error code structure
 *)
FUNCTION Log_Send : ErrorCode
VAR_INPUT
    Priority : LogLevel;
    Format : STRING[1023];
    Args : ...;
END_VAR
END_FUNCTION
(**
 * @brief Set root log priority level.
 *
 * Sets the default log level for all threads running in the actual process.
 * This function sets the level to log only messages with equal or higher
 * priority. For example, if the log level is set to #LOG_LEVEL_WARNING, only
 * warnings and higher priority logs are handled. Log messages lower than
 * #LOG_LEVEL_WARNING are silently suppressed.
 *
 * @param[in] Priority the minimum log priority
 *
 * @return Error code structure
 * @retval M_ERROR_R_INVAL if priority is not valid
 *)
FUNCTION Log_SetRootLevel : ErrorCode
VAR_INPUT
    Priority : LogLevel;
END_VAR
END_FUNCTION
(**
 * @brief Get the root log priority level.
 *
 * This routine returns the root log level.
 *
 * @return the root level
 *)
FUNCTION Log_GetRootLevel : LogLevel
END_FUNCTION
(**
 * @brief Set log priority level.
 *
 * Sets the log level for the actual running thread. This routine is similar to Log_SetRootLevel() but effects the
 * current thread only. Use #LOG_LEVEL_INHERIT to disable the thread specific log level.
 *
 * @param[in] Priority the minimum log priority, or #LOG_LEVEL_INHERIT to inherit the root level.
 *
 * @return Error code structure
 * @retval M_ERROR_R_INVAL if priority is not valid
 *)
FUNCTION Log_SetLevel : ErrorCode
VAR_INPUT
    Priority : LogLevel;
END_VAR
END_FUNCTION
(**
 * @brief Get log priority level.
 *
 * This routine returns the log level for the actual running thread.
 * If no thread specific level is set, the default root level is returned.
 *
 * @return the log level
 *)
FUNCTION Log_GetLevel : LogLevel
END_FUNCTION
(**
 * @brief Determine if log level for given priority is enabled.
 *
 * @param[in] Priority the log priority
 *
 * @return @c true if enabled, @c false otherwise.
 *)
FUNCTION Log_IsEnabled : BOOL
VAR_INPUT
    Priority : LogLevel;
END_VAR
END_FUNCTION
(**
 * @}
 *)
