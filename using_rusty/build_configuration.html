<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Build Configuration - RuSTy User Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">RuSTy User Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="build-configuration"><a class="header" href="#build-configuration">Build Configuration</a></h1>
<p>In addition to the comprehensive help, <code>plc</code> offers a build subcommand that simplifies the build process. </br>
Instead of having numerous inline arguments, using the build subcommand along with a build description file makes passing the arguments easier. </br>
The build description file needs to be saved in the <a href="https://en.wikipedia.org/wiki/JSON">json</a> format.</p>
<p>Usage:
<code>plc build</code></p>
<p>Note that if <code>plc</code> cannot find the <code>plc.json</code> file, it will throw an error and request the path.
The default location for the build file is the current directory.</p>
<p>The command for building with an additional path looks like this:
<code>plc build src/plc.json</code></p>
<h2 id="build-description-file-plcjson"><a class="header" href="#build-description-file-plcjson">Build description file (plc.json)</a></h2>
<p>For the build description file to work, it must be written in the <a href="https://en.wikipedia.org/wiki/JavaScript_Object_Notation">json</a> format.
All the keys used in the build description file are described in the following sections.</p>
<h3 id="files"><a class="header" href="#files">files</a></h3>
<p>The keyword <code>files</code> is the equivalent to the <code>input</code> parameter, which adds all the <code>ST</code> files that need to be compiled.</p>
<p>The value of <code>files</code> is an array of strings, definied as follows:</p>
<pre><code class="language-json">"files" : [
    "examples/hello_world.st",
    "examples/hw.st"
    "examples/*.gvl"
]
</code></pre>
<h3 id="libraries"><a class="header" href="#libraries">libraries</a></h3>
<p>To link several objects into one executable <code>plc</code> has the option to add libraries and automatically build and link them together.</br>
The <code>libraries</code> keyword is optional.</p>
<pre><code class="language-json">"libraries" : [
    {
        "name" : "iec61131std",
        "path" : "path/to/lib/",
        "package" : "Copy",
        "include_path" : [
            "examples/hw.st",
            "examples/hello_world.st"
        ]
    }
]
</code></pre>
<h3 id="output"><a class="header" href="#output">output</a></h3>
<p>Similarly to specifying an output file via the <code>-o</code> or <code>--output</code> option using the command line, in the build file we use <code>"output" : "output.so"</code> to define the output file. The default location is the current build directory. (see <a href="#build-location">Build Location</a>).</p>
<h3 id="compile_type"><a class="header" href="#compile_type">compile_type</a></h3>
<p>The following options can be used for the <code>compile_type</code> :</p>
<ul>
<li><code>Static</code> specifies that linking/binding must be done at compile time.</li>
<li><code>Shared</code> (dynamic) specifies that linking/bingind must be done dynamically (at runtime).</li>
<li><code>PIC</code> Position Independent Code (Choosing this option implies that the linking will be done dynamically).</li>
<li><code>Relocatable</code> generates relocatable object code (for combining with other object code).</li>
<li><code>Bitcode</code> adds bitcode alongside machine code in executable file.</li>
<li><code>IR</code> intermediate <code>llvm</code> representation.</li>
</ul>
<p>The compile format is specified in the build description file as follows:  <code>"compile_type" : "Shared"</code>.
The <code>compile_type</code> keyword is optional.</p>
<h3 id="package_commands"><a class="header" href="#package_commands">package_commands</a></h3>
<p>The <code>package_commands</code> keyword is optional.</p>
<blockquote>
<p>TODO</p>
</blockquote>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<pre><code class="language-json">{
    "files" : [
        "examples/hw.st",
        "examples/hello_world.st",
        "examples/ExternalFunctions.st",
        "examples/*.dt"
    ],
    "compile_type" : "Shared",
    "output" : "proj.so",
    "libraries" : [
        {
            "name" : "iec61131std",
            "path" : "path/to/lib",
            "package" : "Copy",
            "include_path" : [
                "examples/lib.st"
            ]
        },
        {
            "name" : "other_lib",
            "path" : "path/to/lib",
            "package" : "System",
            "include_path" : [
                "examples/hello_world.st"
            ]
        }
    ]
}
</code></pre>
<h2 id="build-parameters"><a class="header" href="#build-parameters">Build Parameters</a></h2>
<p>The <code>build</code> subcommand exposes the following optional parameters:</p>
<h3 id="--build-location"><a class="header" href="#--build-location"><code>--build-location</code></a></h3>
<p>The build location is the location all build files will be copied to. </br>
By default the build location is the <code>build</code> folder in the root of the project (the location of the <code>plc.json</code>).</br>
This can be overriden with the <code>--build-location</code> command line parameter.</p>
<h3 id="--lib-location"><a class="header" href="#--lib-location"><code>--lib-location</code></a></h3>
<p>The lib location is where all libraries marked with <code>Copy</code> will be copied. </br>
By default it is the same as the <code>build-location</code>.</br>
This can be overriden with the <code>--lib-location</code> command line parameter.</p>
<h2 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h2>
<p>Environment variables can be used inside the build description file, the variables are evaluated before an entry is evaluated.</p>
<p>In addition to externally defined variables, the build exports variables that can be referenced in the description file:</p>
<h3 id="project_root"><a class="header" href="#project_root"><code>PROJECT_ROOT</code></a></h3>
<p>The folder containing the <code>plc.json</code> file, i.e. the root of the project.</p>
<h3 id="arch"><a class="header" href="#arch"><code>ARCH</code></a></h3>
<p>The target architecture currently being built, for a multi architecture build.
The value for <code>ARCH</code> will be updated for every target.</p>
<p>Example targets are:
<code>x86_64-pc-linux-gnu</code>, <code>x86_64-pc-windows-msvc</code>, <code>aarch64-pc-linux-musl</code></p>
<h3 id="build_location"><a class="header" href="#build_location"><code>BUILD_LOCATION</code></a></h3>
<p><code>BUILD_LOCATION</code> is the folder where the build will be saved.
This is the value of either the <a href="#build-location"><code>--build-location</code></a> parameter or the default build location.</p>
<h3 id="lib_location"><a class="header" href="#lib_location"><code>LIB_LOCATION</code></a></h3>
<p><code>LIB_LOCATION</code> is the folder where the lib will be saved.
This is the value of either the <a href="#lib-location"><code>--lib-location</code></a> parameter or the <a href="#build-location">build location</a>.</p>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<p>To reference an environment variable in the description file, reference the variables with a preceding <code>$</code>.</p>
<p><strong>Example:</strong></p>
<pre><code class="language-json">{
 "name" : "mylib",
 "path" : "$ARCH/lib",
 "package" : "System",
 "include_path" : [
  "examples/hello_world.st"
 ]
}
</code></pre>
<h2 id="validation"><a class="header" href="#validation">Validation</a></h2>
<p>The build description file uses a <a href="https://json-schema.org/">Json Schema</a> file located at <code>compiler/plc_project/schema/plc-json.schema</code> to validate the build description before build.
In order for the schema to be used, it has to be either in that location for source builds or copied next to the build binaries.
If the schema is not found, the schema based validation will be skipped.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../using_rusty.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../using_rusty/error_configuration.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../using_rusty.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../using_rusty/error_configuration.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../iecst.min.js"></script>
        <script src="../llvm.min.js"></script>
        <script src="../custom.js"></script>
        <script src="../highlight.js"></script>


    </div>
    </body>
</html>
