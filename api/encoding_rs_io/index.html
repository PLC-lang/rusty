<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This crate provides streaming transcoding by implementing Rust’s I&#x2F;O traits and delegating transcoding to the `encoding_rs` crate."><meta name="keywords" content="rust, rustlang, rust-lang, encoding_rs_io"><title>encoding_rs_io - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a class="sidebar-logo" href="../encoding_rs_io/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.png" alt="logo"></div>
        </a><h2 class="location">Crate encoding_rs_io</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.1.7</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all encoding_rs_io's items</p></a><div class="block items"><ul><li><a href="#structs">Structs</a></li></ul></div><div id="sidebar-vars" data-name="encoding_rs_io" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../encoding_rs_io/index.html"><img class="rust-logo" src="../rust-logo.png" alt="logo"></a><nav class="sub"><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">encoding_rs_io</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/encoding_rs_io/lib.rs.html#1-878" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This crate provides streaming transcoding by implementing Rust’s I/O traits
and delegating transcoding to the
<a href="https://crates.io/crates/encoding_rs"><code>encoding_rs</code></a>
crate.</p>
<p>Currently, this crate only provides a means of transcoding from a source
encoding (that is among the encodings supported by <code>encoding_rs</code>) to UTF-8 via
an implementation of <code>std::io::Read</code>, where errors are handled by replacing
invalid sequences with the Unicode replacement character. Future work may
provide additional implementations for <code>std::io::Write</code> and/or implementations
that make stronger guarantees about UTF-8 validity.</p>
<h2 id="example" class="section-header"><a href="#example">Example</a></h2>
<p>This example shows how to create a decoder that transcodes UTF-16LE (the
source) to UTF-8 (the destination).</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">encoding_rs</span>;
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">encoding_rs_io</span>;

<span class="kw">use</span> <span class="ident">std::error::Error</span>;
<span class="kw">use</span> <span class="ident">std::io::Read</span>;

<span class="kw">use</span> <span class="ident">encoding_rs_io::DecodeReaderBytes</span>;

<span class="kw">fn</span> <span class="ident">example</span>() -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span>(), <span class="ident">Box</span><span class="op">&lt;</span><span class="ident">Error</span><span class="op">&gt;</span><span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="ident">source_data</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="string">b&quot;\xFF\xFEf\x00o\x00o\x00b\x00a\x00r\x00&quot;</span>[..];
    <span class="comment">// N.B. `source_data` can be any arbitrary io::Read implementation.</span>
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">decoder</span> <span class="op">=</span> <span class="ident">DecodeReaderBytes::new</span>(<span class="ident">source_data</span>);

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">dest</span> <span class="op">=</span> <span class="ident">String::new</span>();
    <span class="comment">// decoder implements the io::Read trait, so it can easily be plugged</span>
    <span class="comment">// into any consumer expecting an arbitrary reader.</span>
    <span class="ident">decoder</span>.<span class="ident">read_to_string</span>(<span class="kw-2">&amp;mut</span> <span class="ident">dest</span>)<span class="question-mark">?</span>;
    <span class="macro">assert_eq!</span>(<span class="ident">dest</span>, <span class="string">&quot;foobar&quot;</span>);
    <span class="prelude-val">Ok</span>(())
}</code></pre></div>
<h2 id="future-work" class="section-header"><a href="#future-work">Future work</a></h2>
<p>Currently, this crate only provides a way to get <em>possibly valid</em> UTF-8 from
some source encoding. There are other transformations that may be useful that
we could include in this crate. Namely:</p>
<ul>
<li>An encoder that accepts an arbitrary <code>std::io::Write</code> implementation and
takes valid UTF-8 and transcodes it to a selected destination encoding. This
encoder would implement <code>std::fmt::Write</code>.</li>
<li>A decoder that accepts an arbitrary <code>std::fmt::Write</code> implementation and
takes arbitrary bytes and transcodes them from a selected source
encoding to valid UTF-8. This decoder would implement <code>std::io::Write</code>.</li>
<li>An encoder that accepts an arbitrary <code>UnicodeRead</code> implementation and
takes valid UTF-8 and transcodes it to a selected destination encoding.
This encoder would implement <code>std::io::Read</code>.</li>
<li>A decoder that accepts an arbitrary <code>std::io::Read</code> implementation and
takes arbitrary bytes and transcodes them from a selected source encoding
to valid UTF-8. This decoder would implement the <code>UnicodeRead</code> trait.</li>
</ul>
<p>Where <code>UnicodeRead</code> is a hypothetical trait that does not yet exist. Its
definition might look something like this:</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="kw">trait</span> <span class="ident">UnicodeRead</span> {
    <span class="kw">fn</span> <span class="ident">read</span>(<span class="kw-2">&amp;mut</span> <span class="self">self</span>, <span class="ident">buf</span>: <span class="kw-2">&amp;mut</span> <span class="ident">str</span>) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">usize</span><span class="op">&gt;</span>;
}</code></pre></div>
<p>Interestingly, of the above transformations, none of them correspond to
<code>DecodeReaderBytes</code>. Namely, <code>DecodeReaderBytes</code> most closely corresponds to
the last option, but instead of guaranteeing valid UTF-8 by implementing a
trait like <code>UnicodeRead</code>, it instead implements <code>std::io::Read</code>, which pushes
UTF-8 handling on to the caller. However, it turns out that this particular
use case is important for operations like search, which can often be written
in a way that don’t assume UTF-8 validity but still benefit from it.</p>
<p>It’s not clear which of the above transformations is actually useful, but all
of them could theoretically exist. There is more discussion on this topic
here (and in particular, the above formulation was taken almost verbatim from
Simon Sapin’s comments): https://github.com/hsivonen/encoding_rs/issues/8</p>
<p>It is also perhaps worth stating that this crate very much intends on
remaining coupled to <code>encoding_rs</code>, which helps restrict the scope, but may be
too biased toward Web oriented encoding to solve grander encoding challenges.
As such, it may very well be that this crate is actually a stepping stone to
something with a larger scope. But first, we must learn.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DecodeReaderBytes.html" title="encoding_rs_io::DecodeReaderBytes struct">DecodeReaderBytes</a></div><div class="item-right docblock-short"><p>An implementation of <code>io::Read</code> that transcodes to UTF-8 in a streaming
fashion.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DecodeReaderBytesBuilder.html" title="encoding_rs_io::DecodeReaderBytesBuilder struct">DecodeReaderBytesBuilder</a></div><div class="item-right docblock-short"><p>A builder for constructing a byte oriented transcoder to UTF-8.</p>
</div></div></div></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="encoding_rs_io" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.59.0 (9d1b2106e 2022-02-23)" ></div>
</body></html>