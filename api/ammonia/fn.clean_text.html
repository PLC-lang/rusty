<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Turn an arbitrary string into unformatted HTML."><title>clean_text in ammonia - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-492a78a4a87dcc01.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="ammonia" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0 (f6e511eec 2024-10-15)" data-channel="1.82.0" data-search-js="search-a99f1315e7cc5121.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-921df33f47b8780c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../ammonia/index.html">ammonia</a><span class="version">4.0.0</span></h2></div><div class="sidebar-elems"></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="index.html">ammonia</a>::<wbr><a class="fn" href="#">clean_text</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/ammonia/lib.rs.html#128-165">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub fn clean_text(src: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a></code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Turn an arbitrary string into unformatted HTML.</p>
<p>This function is roughly equivalent to PHP’s <code>htmlspecialchars</code> and <code>htmlentities</code>.
It is as strict as possible, encoding every character that has special meaning to the
HTML parser.</p>
<h2 id="warnings"><a class="doc-anchor" href="#warnings">§</a>Warnings</h2>
<p>This function cannot be used to package strings into a <code>&lt;script&gt;</code> or <code>&lt;style&gt;</code> tag;
you need a JavaScript or CSS escaper to do that.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// DO NOT DO THIS
</span><span class="kw">let </span>untrusted = <span class="string">"Robert\"); abuse();//"</span>;
<span class="kw">let </span>html = <span class="macro">format!</span>(<span class="string">"&lt;script&gt;invoke(\"{}\")&lt;/script&gt;"</span>, clean_text(untrusted));</code></pre></div>
<p><code>&lt;textarea&gt;</code> tags will strip the first newline, if present, even if that newline is encoded.
If you want to build an editor that works the way most folks expect them to, you should put a
newline at the beginning of the tag, like this:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>untrusted = <span class="string">"\n\nhi!"</span>;
<span class="kw">let </span><span class="kw-2">mut </span>b = Builder::new();
b.add_tags(<span class="kw-2">&amp;</span>[<span class="string">"textarea"</span>]);
<span class="comment">// This is the bad version
// The user put two newlines at the beginning, but the first one was removed
</span><span class="kw">let </span>sanitized = b.clean(<span class="kw-2">&amp;</span><span class="macro">format!</span>(<span class="string">"&lt;textarea&gt;{}&lt;/textarea&gt;"</span>, clean_text(untrusted))).to_string();
<span class="macro">assert_eq!</span>(<span class="string">"&lt;textarea&gt;\nhi!&lt;/textarea&gt;"</span>, sanitized);
<span class="comment">// This is a good version
// The user put two newlines at the beginning, and we add a third one,
// so the result still has two
</span><span class="kw">let </span>sanitized = b.clean(<span class="kw-2">&amp;</span><span class="macro">format!</span>(<span class="string">"&lt;textarea&gt;\n{}&lt;/textarea&gt;"</span>, clean_text(untrusted))).to_string();
<span class="macro">assert_eq!</span>(<span class="string">"&lt;textarea&gt;\n\nhi!&lt;/textarea&gt;"</span>, sanitized);
<span class="comment">// This version is also often considered good
// For many applications, leading and trailing whitespace is probably unwanted
</span><span class="kw">let </span>sanitized = b.clean(<span class="kw-2">&amp;</span><span class="macro">format!</span>(<span class="string">"&lt;textarea&gt;{}&lt;/textarea&gt;"</span>, clean_text(untrusted.trim()))).to_string();
<span class="macro">assert_eq!</span>(<span class="string">"&lt;textarea&gt;hi!&lt;/textarea&gt;"</span>, sanitized);</code></pre></div>
<p>It also does not make user text safe for HTML attribute microsyntaxes such as <code>class</code> or <code>id</code>.
Only use this function for places where HTML accepts unrestricted text such as <code>title</code> attributes
and paragraph contents.</p>
</div></details></section></div></main></body></html>