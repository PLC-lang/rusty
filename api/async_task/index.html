<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Task abstraction for building executors."><title>async_task - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="async_task" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.1 (3f5fd8dd4 2024-08-06)" data-channel="1.80.1" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="icon" href="https://raw.githubusercontent.com/smol-rs/smol/master/assets/images/logo_fullsize_transparent.png"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../async_task/index.html"><img src="https://raw.githubusercontent.com/smol-rs/smol/master/assets/images/logo_fullsize_transparent.png" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../async_task/index.html"><img src="https://raw.githubusercontent.com/smol-rs/smol/master/assets/images/logo_fullsize_transparent.png" alt="logo"></a><h2><a href="../async_task/index.html">async_task</a><span class="version">4.7.1</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">async_task</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/async_task/lib.rs.html#1-118">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Task abstraction for building executors.</p>
<p>To spawn a future onto an executor, we first need to allocate it on the heap and keep some
state attached to it. The state indicates whether the future is ready for polling, waiting to
be woken up, or completed. Such a stateful future is called a <em>task</em>.</p>
<p>All executors have a queue that holds scheduled tasks:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>(sender, receiver) = flume::unbounded();</code></pre></div>
<p>A task is created using either <a href="fn.spawn.html" title="fn async_task::spawn"><code>spawn()</code></a>, <a href="fn.spawn_local.html" title="fn async_task::spawn_local"><code>spawn_local()</code></a>, or <a href="fn.spawn_unchecked.html" title="fn async_task::spawn_unchecked"><code>spawn_unchecked()</code></a> which
return a <a href="struct.Runnable.html" title="struct async_task::Runnable"><code>Runnable</code></a> and a <a href="struct.Task.html" title="struct async_task::Task"><code>Task</code></a>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// A future that will be spawned.
</span><span class="kw">let </span>future = <span class="kw">async </span>{ <span class="number">1 </span>+ <span class="number">2 </span>};

<span class="comment">// A function that schedules the task when it gets woken up.
</span><span class="kw">let </span>schedule = <span class="kw">move </span>|runnable| sender.send(runnable).unwrap();

<span class="comment">// Construct a task.
</span><span class="kw">let </span>(runnable, task) = async_task::spawn(future, schedule);

<span class="comment">// Push the task into the queue by invoking its schedule function.
</span>runnable.schedule();</code></pre></div>
<p>The <a href="struct.Runnable.html" title="struct async_task::Runnable"><code>Runnable</code></a> is used to poll the task’s future, and the <a href="struct.Task.html" title="struct async_task::Task"><code>Task</code></a> is used to await its
output.</p>
<p>Finally, we need a loop that takes scheduled tasks from the queue and runs them:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">for </span>runnable <span class="kw">in </span>receiver {
    runnable.run();
}</code></pre></div>
<p>Method <a href="struct.Runnable.html#method.run" title="method async_task::Runnable::run"><code>run()</code></a> polls the task’s future once. Then, the <a href="struct.Runnable.html" title="struct async_task::Runnable"><code>Runnable</code></a>
vanishes and only reappears when its <a href="https://doc.rust-lang.org/1.80.1/core/task/wake/struct.Waker.html" title="struct core::task::wake::Waker"><code>Waker</code></a> wakes the task, thus
scheduling it to be run again.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Builder.html" title="struct async_task::Builder">Builder</a></div><div class="desc docblock-short">A builder that creates a new task.</div></li><li><div class="item-name"><a class="struct" href="struct.FallibleTask.html" title="struct async_task::FallibleTask">FallibleTask</a></div><div class="desc docblock-short">A spawned task with a fallible response.</div></li><li><div class="item-name"><a class="struct" href="struct.Runnable.html" title="struct async_task::Runnable">Runnable</a></div><div class="desc docblock-short">A handle to a runnable task.</div></li><li><div class="item-name"><a class="struct" href="struct.ScheduleInfo.html" title="struct async_task::ScheduleInfo">ScheduleInfo</a></div><div class="desc docblock-short">Extra scheduling information that can be passed to the scheduling function.</div></li><li><div class="item-name"><a class="struct" href="struct.Task.html" title="struct async_task::Task">Task</a></div><div class="desc docblock-short">A spawned task.</div></li><li><div class="item-name"><a class="struct" href="struct.WithInfo.html" title="struct async_task::WithInfo">WithInfo</a></div><div class="desc docblock-short">Pass a scheduling function with more scheduling information - a.k.a.
<a href="struct.ScheduleInfo.html" title="struct async_task::ScheduleInfo"><code>ScheduleInfo</code></a>.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.Schedule.html" title="trait async_task::Schedule">Schedule</a></div><div class="desc docblock-short">The trait for scheduling functions.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.spawn.html" title="fn async_task::spawn">spawn</a></div><div class="desc docblock-short">Creates a new task.</div></li><li><div class="item-name"><a class="fn" href="fn.spawn_local.html" title="fn async_task::spawn_local">spawn_local</a></div><div class="desc docblock-short">Creates a new thread-local task.</div></li><li><div class="item-name"><a class="fn" href="fn.spawn_unchecked.html" title="fn async_task::spawn_unchecked">spawn_unchecked</a><sup title="unsafe function">⚠</sup></div><div class="desc docblock-short">Creates a new task without <a href="https://doc.rust-lang.org/1.80.1/core/marker/trait.Send.html" title="trait core::marker::Send"><code>Send</code></a>, <a href="https://doc.rust-lang.org/1.80.1/core/marker/trait.Sync.html" title="trait core::marker::Sync"><code>Sync</code></a>, and <code>'static</code> bounds.</div></li></ul></section></div></main></body></html>