---
source: src/codegen/tests/multifile_codegen_tests.rs
expression: "codegen_multi(units, crate::DebugLevel::None).join(\"\\n\")"
---
; ModuleID = 'func.st'
source_filename = "func.st"
target datalayout = "[filtered]"
target triple = "[filtered]"

define i32 @func() {
entry:
  %func = alloca i32, align 4
  store i32 0, ptr %func, align 4
  %func_ret = load i32, ptr %func, align 4
  ret i32 %func_ret
}

; ModuleID = 'fb.st'
source_filename = "fb.st"
target datalayout = "[filtered]"
target triple = "[filtered]"

%fb = type {}

@__fb__init = unnamed_addr constant %fb zeroinitializer

define void @fb(ptr %0) {
entry:
  %this = alloca ptr, align 8
  store ptr %0, ptr %this, align 8
  ret void
}

; ModuleID = 'prg.st'
source_filename = "prg.st"
target datalayout = "[filtered]"
target triple = "[filtered]"

%prg = type { i32 }

@prg_instance = global %prg zeroinitializer

define void @prg(ptr %0) {
entry:
  %a = getelementptr inbounds nuw %prg, ptr %0, i32 0, i32 0
  ret void
}

; ModuleID = 'prg2.st'
source_filename = "prg2.st"
target datalayout = "[filtered]"
target triple = "[filtered]"

%prg2 = type { i32 }

@prg2_instance = global %prg2 zeroinitializer

define void @prg2(ptr %0) {
entry:
  %b = getelementptr inbounds nuw %prg2, ptr %0, i32 0, i32 0
  ret void
}

; ModuleID = 'prog.st'
source_filename = "prog.st"
target datalayout = "[filtered]"
target triple = "[filtered]"

%prog = type { %fb.4 }
%fb.4 = type {}
%prg.5 = type { i32 }
%prg2.6 = type { i32 }

@prog_instance = global %prog zeroinitializer
@__fb__init = external unnamed_addr constant %fb.4
@prg_instance = external global %prg.5
@prg2_instance = external global %prg2.6

define void @prog(ptr %0) {
entry:
  %myFb = getelementptr inbounds nuw %prog, ptr %0, i32 0, i32 0
  %load_a = load i32, ptr @prg_instance, align 4
  call void @prg2(ptr @prg2_instance)
  %call = call i32 @func()
  call void @fb(ptr %myFb)
  ret void
}

declare void @fb(ptr)

declare void @prg(ptr)

declare void @prg2(ptr)

declare i32 @func()
